# Web サービス「Sweet Sprouts」詳細技術選定書

## 1. 概要

本ドキュメントは、Web サービス「Sweet Sprouts」のシステムを構築する上で採用する**具体的な技術スタック**と、それぞれの**選定理由**を詳細に定義します。要件定義、外部設計、内部設計（アーキテクチャ、データベース、API）を踏まえ、開発効率、パフォーマンス、スケーラビリティ、保守性、そしてコスト最適化の観点から最適な技術を選択しました。

## 2. フロントエンド（React + TypeScript）

ユーザーが直接操作するクライアントサイドアプリケーションです。Vercel でホスティングされ、高速なレスポンスと直感的な UI を提供します。

- **フレームワーク**: **React**
  - **選定理由**: コンポーネント指向のアプローチにより、UI の再利用性とモジュール性が高く、大規模な UI 開発に適しています。豊富なエコシステムと活発なコミュニティは、問題解決や学習リソースの面で強力なサポートとなります。宣言的な UI 構築は、コードの可読性と保守性を向上させます。
- **言語**: **TypeScript**
  - **選定理由**: JavaScript に静的型付けをもたらし、開発段階での型関連のエラーを早期に発見できます。これにより、特にアプリケーションの規模が拡大するにつれて、コードの品質、堅牢性、可読性、そしてチーム開発における生産性が飛躍的に向上します。
- **UI フレームワーク/CSS**: **Tailwind CSS**
  - **選定理由**: ユーティリティファーストのアプローチにより、HTML 内で直接スタイリングを行うことができ、CSS の記述量を大幅に削減します。これにより、開発速度が向上し、スタイルの一貫性を保ちやすくなります。また、ビルド時に使用されていない CSS が除去されるため、最終的なバンドルサイズを小さく抑えられます。
- **状態管理**: **Zustand**
  - **選定理由**: 軽量で非常にシンプルながら強力な状態管理ライブラリです。React Context API よりもパフォーマンスが高く、Redux のようなボイラープレート（定型コード）を大幅に削減できます。学習コストが低く、直感的な API は開発効率を高めます。
- **API 呼び出し**: **Axios**
  - **選定理由**: 広範なプロジェクトで採用されている実績ある HTTP クライアントです。Promise ベースの API は非同期処理を扱いやすく、インターセプター機能により、認証トークンの自動付与やエラーハンドリングの一元化を容易に行えます。
- **データフェッチング/キャッシュ**: **SWR**
  - **選定理由**: 「Stale-while-revalidate（古くなったデータを表示しつつ、バックグラウンドで再検証する）」というキャッシュ戦略に基づき、API からのデータ取得、キャッシュ、リアルタイム更新を効率的に行います。これにより、ユーザー体験が向上し、開発者はデータ同期に関する複雑なロジックから解放されます。特にタイムラインのような頻繁に更新されるデータの表示に適しています。
- **ルーティング**: **React Router DOM**
  - **選定理由**: React アプリケーションのデファクトスタンダードであり、URL と UI コンポーネントのマッピングを直感的に行えます。強力なネストされたルーティング機能と豊富なフックにより、SPA（Single Page Application）における複雑なナビゲーション要件にも対応可能です。
- **フォーム管理**: **React Hook Form**
  - **選定理由**: パフォーマンスに優れ、複雑なフォームのバリデーションと状態管理をシンプルに行えるライブラリです。再レンダリングを最小限に抑え、バリデーションロジックを直感的に記述できるため、開発者の負担を軽減します。
- **バリデーション**: **Zod**
  - **選定理由**: TypeScript ファーストのスキーマバリデーションライブラリであり、ランタイムと型推論の両方で強力に動作します。**バックエンドと共通のスキーマ定義を共有できる**ため、API の入出力とデータベースモデルの型安全性を強力に保証し、フロントエンド・バックエンド間でのデータ形式の不一致によるバグを大幅に削減します。ユーザー入力の早期バリデーションにより、不必要な API 呼び出しを減らし、ユーザー体験を向上させます。
- **自動テスト**: **Vitest + React Testing Library** (ユニット/結合テスト), **Playwright** (E2E テスト)
  - **選定理由**:
    - **Vitest**: Vite をベースとした高速なテストフレームワークです。開発サーバーと統合されており、非常に高速なフィードバックループと Jest 互換の API を提供するため、開発体験が非常に良いです。フロントエンドのコンポーネントやユーティリティ関数のユニットテスト、コンポーネント間の結合テストに最適です。
    - **React Testing Library**: ユーザーの視点からコンポーネントの振る舞いをテストすることに重点を置いたライブラリです。実装の詳細（例: 内部状態）ではなく、ユーザーが UI をどのように操作し、それがどのように反応するかをテストするため、より堅牢でリファクタリングに強いテストコードを記述できます。
    - **Playwright**: Microsoft が開発した E2E（End-to-End）テストフレームワークです。Chromium、Firefox、WebKit といった主要なブラウザに対応し、実際のユーザー操作をシミュレートしてシナリオ全体をテストできます。CI/CD パイプラインに組み込むことで、リリースの信頼性を高めます。
- **Linter/Formatter**: **ESLint**, **Prettier**
  - **選定理由**: コードの品質と一貫性を自動的に強制するための必須ツールです。ESLint は構文エラーや潜在的なバグを検出し、コードスタイルのルールを適用します。Prettier はコードのフォーマットを自動化し、チームメンバー間でのコーディングスタイル論争をなくします。

## 3. バックエンド（Node.js + Express）

フロントエンドからの API リクエストを受け付け、ビジネスロジックを実行し、データベースと連携する API サーバーです。Docker コンテナとして Render にデプロイされます。

- **フレームワーク**: **Node.js (Express.js)**
  - **選定理由**: 軽量で柔軟なウェブアプリケーションフレームワークであり、RESTful API の構築に広く利用されています。Node.js の非同期 I/O モデルは、高い並行処理能力を必要とする API サービスに適しています。
- **言語**: **TypeScript**
  - **選定理由**: フロントエンドとの共通言語であるため、開発チーム全体の学習コストを抑えられます。型安全性は API のインターフェースの明確化、バグの削減、そして大規模なバックエンド開発での保守性向上に寄与します。
- **データベース ORM**: **Prisma**
  - **選定理由**: 次世代の ORM ツールキットとして、特に TypeScript との親和性が非常に高いことが最大の選定理由です。スキーマ定義から型安全なデータベースクライアントを自動生成し、データベース操作における開発体験と生産性を大幅に向上させます。複雑なリレーションクエリも直感的に記述でき、データベースマイグレーションツールも統合されています。Knex.js よりも高い型安全性を提供します。
- **認証**: **JWT (JSON Web Tokens) + bcrypt.js**
  - **選定理由**:
    - **JWT**: ステートレスな認証メカニズムを提供するため、サーバーサイドでのセッション管理が不要となり、水平スケーリングが容易になります。トークンは署名されており、改ざんを検知できます。
    - **bcrypt.js**: パスワードを安全にハッシュ化するための、業界標準の堅牢なアルゴリズムです。ストレッチング（計算負荷を意図的に高める）により、ブルートフォース攻撃に対する耐性を提供し、ユーザーパスワードのセキュリティを確保します。
- **バリデーション**: **Zod**
  - **選定理由**: フロントエンドと同様に Zod を採用することで、**API のリクエストボディやクエリパラメータのバリデーションスキーマをフロントエンドと共有し、再利用できます。** これにより、API の契約が明確になり、両サイドでのデータ形式の不整合によるバグを効果的に防止できます。
- **自動テスト**: **Vitest** (ユニット/結合テスト), **Supertest** (API テスト)
  - **選定理由**:
    - **Vitest**: フロントエンドと同様に高速なテストフレームワークとして、バックエンドのビジネスロジックやユーティリティ関数のユニットテスト、モジュール間の結合テストに最適です。Vite ベースの高速な実行は、テスト駆動開発（TDD）のフィードバックループを短縮します。
    - **Supertest**: Express アプリケーションの API エンドポイントを簡単にテストするためのライブラリです。実際の HTTP リクエストをシミュレートし、レスポンスのステータスコード、ヘッダー、ボディの内容を簡潔に検証できるため、API の信頼性を確保するのに役立ちます。
- **Linter/Formatter**: **ESLint**, **Prettier**
  - **選定理由**: フロントエンドと同様に、コードベース全体の一貫性と品質を保つため、自動的なコードチェックとフォーマットを導入します。

## 4. データベース（PostgreSQL）

アプリケーションの永続的なデータを保存・管理します。Render のマネージドサービスを利用します。

- **データベースシステム**: **PostgreSQL**
  - **選定理由**: オープンソースのリレーショナルデータベースとして高い信頼性と豊富な機能を持ちます。ACID 特性を完全にサポートし、データの整合性を保証します。地理空間データや JSONB 型など、モダンなアプリケーションが求めるデータ型にも対応しており、将来的な機能拡張にも柔軟に対応できます。
- **データベースクライアント**: **Prisma Client**
  - **選定理由**: Prisma ORM が生成する、アプリケーションコードからデータベースを操作するための型安全なクライアントです。開発者は複雑な SQL クエリを直接記述することなく、TypeScript のオブジェクトとしてデータベースを扱えるため、開発効率と安全性が向上します。
- **マイグレーションツール**: **Prisma Migrate**
  - **選定理由**: データベーススキーマの変更履歴をコードとして管理し、バージョン管理された形で適用するためのツールです。Prisma のスキーマ定義 (`schema.prisma`) から変更を検出し、差分 SQL を自動生成できるため、データベースの変更管理が容易になり、チーム開発におけるスキーマの同期問題を解消します。

## 5. 開発・運用ツール

開発プロセス全体と、アプリケーションのデプロイおよび運用を支援するツールです。

- **バージョン管理**: **Git (GitHub)**
  - **選定理由**: ソースコードの変更履歴を管理し、複数人での並行開発を可能にするデファクトスタンダードです。GitHub は、プライベートリポジトリ、Issue トラッキング、Pull Request によるコードレビューなど、チーム開発に必要な機能を包括的に提供します。
- **コンテナ化**: **Docker**
  - **選定理由**: アプリケーションとその依存関係を一つのポータブルなコンテナにパッケージ化することで、開発環境と本番環境の差異をなくし、「私のマシンでは動くのに…」といった問題を解消します。デプロイプロセスが標準化され、環境構築の手間が削減されます。
- **CI/CD**: **GitHub Actions**
  - **選定理由**: GitHub に統合された CI/CD サービスであり、リポジトリへのコードプッシュをトリガーに、自動テストの実行、フロントエンドの Vercel へのデプロイ、バックエンドの Render へのデプロイを自動化します。これにより、開発からリリースまでのリードタイムを短縮し、手動デプロイによるヒューマンエラーを最小限に抑え、品質を維持します。
- **パッケージマネージャー**: **npm**
  - **選定理由**: Node.js の公式パッケージマネージャーであり、最も広く普及しています。学習コストが低く、豊富なパッケージが利用可能です。大規模なモノレポでの特定の高度な要件（例: Plug'n'Play）がない限り、そのシンプルさと普及度が開発の障壁を低く保ちます。

## 6. ホスティングサービス

アプリケーションの公開と運用を担うクラウドサービスです。

- **フロントエンドホスティング**: **Vercel**
  - **選定理由**: モダンなフロントエンドフレームワーク（React など）との統合が非常に強力です。Git 連携による自動デプロイ、グローバル CDN による高速なコンテンツ配信、無料で利用できるプランが、MVP の迅速な公開と低コスト運用に適しています。
- **バックエンド/データベースホスティング**: **Render**
  - **選定理由**: Web サービス（Docker コンテナ対応）とマネージド PostgreSQL データベースをシンプルにデプロイ・管理できるプラットフォームです。アイドル時の自動スピンダウン機能により、コストを大幅に削減できます。GitHub 連携による CI/CD も容易に設定でき、MVP 段階からスケーラブルなインフラを構築できます。

---
